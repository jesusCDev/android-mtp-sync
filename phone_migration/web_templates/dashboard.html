{% extends "base.html" %}
{% block title %}Dashboard - Phone Migration Tool{% endblock %}

<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    {% block extra_styles %}{% endblock %}

<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>

{% block content %}
<div class="card">
    <h2><i class="fas fa-mobile-alt"></i> Device Status</h2>
    <div id="device-status">
        <div class="spinner"></div>
    </div>
</div>

<div class="card">
    <h2><i class="fas fa-play-circle"></i> Run Operations</h2>
    
    <div id="run-status-indicator" class="status-indicator">
        <i class="fas fa-circle" style="color: var(--text-muted); font-size: 10px;"></i>
        <span id="run-status-text" style="color: var(--text-muted);">Ready to run</span>
    </div>
    
    <div class="run-options">
        <div class="option-card selected" onclick="toggleOption('dry_run')" id="dry-run-option">
            <div style="display: flex; align-items: center; gap: 12px;">
                <i class="fas fa-eye" style="color: var(--warning); font-size: 20px;"></i>
                <div>
                    <div style="font-weight: 600; color: var(--text); font-size: 14px;">Dry Run</div>
                    <div style="font-size: 12px; color: var(--text-muted);">Preview changes without modifying</div>
                </div>
            </div>
            <div class="toggle-switch"></div>
        </div>
        
        <div class="option-card selected" onclick="toggleOption('notify')" id="notify-option">
            <div style="display: flex; align-items: center; gap: 12px;">
                <i class="fas fa-bell" style="color: var(--info); font-size: 20px;"></i>
                <div>
                    <div style="font-weight: 600; color: var(--text); font-size: 14px;">Notifications</div>
                    <div style="font-size: 12px; color: var(--text-muted);">Get desktop alerts</div>
                </div>
            </div>
            <div class="toggle-switch"></div>
        </div>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
        <button id="run-btn" class="btn btn-success" onclick="startRun()" style="width: 100%;">
            <i class="fas fa-play"></i> Run All Rules
        </button>
        <button id="manual-btn" class="btn btn-secondary" onclick="openManualRulesModal()" style="width: 100%;">
            <i class="fas fa-hand-paper"></i> Run Manual Rules
        </button>
    </div>
</div>

<!-- Manual Rules Selection Panel -->
<div class="card" id="manual-selection-card" style="display: none;">
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
        <h2 style="margin: 0;"><i class="fas fa-hand-paper"></i> Select Manual Rules</h2>
        <button class="btn btn-secondary btn-sm" onclick="closeManualSelection()">
            <i class="fas fa-times"></i> Cancel
        </button>
    </div>
    
    <div id="manual-rules-list" style="margin-bottom: 16px;">
        <div style="text-align: center; padding: 40px; color: var(--text-muted);">
            <i class="fas fa-spinner fa-spin" style="font-size: 24px;"></i>
            <div style="margin-top: 12px;">Loading manual rules...</div>
        </div>
    </div>
    
    <button id="run-selected-btn" class="btn btn-success" onclick="runSelectedManualRules()" style="width: 100%;">
        <i class="fas fa-play"></i> Run Selected Rules
    </button>
</div>

<div class="card" id="stats-card" style="display: none;">
    <h2><i class="fas fa-chart-bar"></i> Statistics</h2>
    <div class="stats-grid">
        <div class="stat-box">
            <div class="stat-value" id="stat-moved">0</div>
            <div class="stat-label">Files Moved</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="stat-backed-up">0</div>
            <div class="stat-label">Files Backed Up</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="stat-synced">0</div>
            <div class="stat-label">Files Synced</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="stat-errors">0</div>
            <div class="stat-label">Errors</div>
        </div>
    </div>
</div>

<div class="card" id="output-card" style="display: none;">
    <h2><i class="fas fa-list-alt"></i> Operations</h2>
    <div id="operations-container"></div>
</div>

<div id="alert-container"></div>
{% endblock %}

{% block extra_scripts %}{% endblock %}
